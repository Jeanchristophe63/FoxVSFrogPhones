<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Pacman_Renard â€” 4 labyrinthes</title>
<style>
  body { background:#000; margin:0; font-family:monospace; color:#fff; text-align:center; user-select:none; }
  #game-container { display:inline-block; position:relative; }
  canvas { background:#ccc; display:block; margin:0 auto; image-rendering:pixelated; }
  #score { margin:12px 0; }
  #controls { margin:10px 0 6px; display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap; }
  label { opacity:.9; }
  input, select, button { font-size:16px; padding:6px 10px; }
  #timer { font-size:20px; margin:6px 0 10px; font-weight:bold; }
  #mobile-controls { margin:10px 0; display:flex; justify-content:center; gap:6px; flex-wrap:wrap; }
  #mobile-controls button { width:120px; height:120px; font-size:80px; }
  #popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.9);
    color: white;
    padding: 20px 40px;
    border-radius: 12px;
    font-size: 20px;
    display: none;
    z-index: 9999;
    text-align: center;
    animation: fadeIn 0.4s ease;
  }
  #popup button {
    margin-top: 15px;
    padding: 8px 16px;
    background: #ff9800;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    color: white;
    font-size: 16px;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translate(-50%, -60%); }
    to   { opacity: 1; transform: translate(-50%, -50%); }
  }
</style>
</head>
<body>

<div id="controls">
  <label for="scale">Zoom :</label>
  <input type="number" id="scale" value="25" min="16" max="64" step="4" />
  <label for="ghostCount">FantÃ´mes (2â€“5) :</label>
  <select id="ghostCount">
    <option value="2">2</option>
    <option value="3" selected>3</option>
    <option value="4">4</option>
    <option value="5">5</option>
  </select>
  <button id="startBtn">DÃ©marrer</button>
</div>

<div id="timer">Temps restant : 02:00</div>
<div id="score">Score : 0 | Vies : 3</div>
<div id="game-container">
  <canvas id="game"></canvas>
</div>

<div id="mobile-controls">
  <button id="up">â–²</button>
</div>
<div id="mobile-controls">
  <button id="left">â—€</button>
  <button id="down">â–¼</button>
  <button id="right">â–¶</button>
</div>

<div id="popup">
  <p id="popupMessage">ðŸŽ‰ Bravo, labyrinthe terminÃ© !</p>
  <button onclick="nextLevel()">Continuer</button>
</div>

<script>
/* =======================
   PARAMÃˆTRES
======================= */
const PLAYER_SPEED = 60;
const GHOST_SPEED = 2;
const FROG_SPAWN_RATE = 99;
const LEVEL_TIME = 150;
const DEFAULT_NUM_GHOSTS = 2;
const rows = 15, cols = 14;

const labyrinths = [
  // Labyrinthe 1
  [[1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,1,1,1,1,1,1,1,0,0,1],[1,0,1,0,0,0,0,0,0,0,1,0,0,1],[1,0,1,0,1,1,1,1,1,0,1,0,1,1],[1,0,1,0,1,0,0,0,1,0,1,0,0,1],[1,0,1,0,0,0,1,1,1,0,1,0,0,1],[1,0,1,0,1,0,1,0,0,0,1,1,0,1],[1,0,0,0,1,0,1,0,1,1,1,0,0,1],[1,0,1,0,1,0,0,0,0,0,1,0,1,1],[1,0,1,0,1,1,1,0,1,0,1,0,0,1],[1,0,0,0,0,0,0,0,1,0,1,0,1,1],[1,0,1,1,1,1,1,1,1,0,1,0,0,1],[1,0,0,0,0,0,1,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1]],
  // Labyrinthe 2
  [[1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,1,0,0,0,0,1,0,0,0,1],[1,0,1,0,1,0,1,1,0,1,0,1,0,1],[1,0,1,0,0,0,1,0,0,1,0,1,0,1],[1,0,1,1,1,0,1,0,1,1,0,1,0,1],[1,0,0,0,1,0,0,0,1,0,0,1,0,1],[1,1,1,0,1,1,1,0,1,0,1,1,0,1],[1,0,0,0,0,0,0,0,1,0,0,0,0,1],[1,0,1,1,1,1,1,1,1,1,1,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,1,0,1],[1,1,1,1,0,1,1,1,1,1,0,1,0,1],[1,0,0,0,0,0,0,0,0,1,0,1,0,1],[1,0,1,1,1,1,1,1,0,1,0,0,0,1],[1,0,0,0,0,0,0,0,0,1,1,1,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1]],
  // Labyrinthe 3
  [[1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,1,0,0,0,1,0,0,0,0,0,0,1],[1,0,1,1,1,0,1,0,1,1,1,1,0,1],[1,0,0,0,1,0,0,0,1,0,0,1,0,1],[1,1,1,0,1,1,1,1,1,0,1,1,0,1],[1,0,0,0,0,0,0,0,0,0,1,0,0,1],[1,0,1,1,1,1,1,1,1,0,1,0,1,1],[1,0,0,0,0,0,0,0,1,0,0,0,0,1],[1,1,1,1,1,1,0,1,1,1,1,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,1,1,1,1,1,1,1,0,1,0,1],[1,0,0,0,0,0,0,0,0,1,0,1,0,1],[1,0,1,1,1,1,1,1,0,1,0,0,0,1],[1,0,0,0,0,0,0,0,0,1,1,1,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1]],
  // Labyrinthe 4
  [[1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,1,0,0,0,0,0,0,1],[1,0,1,1,1,0,1,0,1,1,1,1,0,1],[1,0,1,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,0,1,1,1,1,1,1,0,1,0,1],[1,0,0,0,1,0,0,0,0,1,0,1,0,1],[1,1,1,0,1,0,1,1,0,1,0,1,0,1],[1,0,0,0,0,0,1,0,0,0,0,0,0,1],[1,0,1,1,1,1,1,1,1,1,1,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,1,0,1],[1,1,1,1,0,1,1,1,1,1,0,1,0,1],[1,0,0,0,0,0,0,0,0,1,0,1,0,1],[1,0,1,1,1,1,1,1,0,1,0,0,0,1],[1,0,0,0,0,0,0,0,0,1,1,1,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1]]
];

/* =======================
   DOM & Ã‰TAT
======================= */
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const timerEl = document.getElementById('timer');
const startBtn = document.getElementById('startBtn');
const scaleInput = document.getElementById('scale');
const ghostCountSel = document.getElementById('ghostCount');
const mobileUp = document.getElementById('up');
const mobileDown = document.getElementById('down');
const mobileLeft = document.getElementById('left');
const mobileRight = document.getElementById('right');

let scale = parseInt(scaleInput.value);
let labyrinth = [];
let score = 0, lives = 3, currentLabIndex = 0;
let player = {x:1, y:1, xPos:1*scale, yPos:1*scale, dir:null, moving:false};
let ghosts = [];
let gameInterval = null;
let timerInterval = null;
let timeRemaining = LEVEL_TIME;
let gameRunning = false;
let respawning = false;
let totalFrogs = 0;

/* =======================
   IMAGES
======================= */
const imgRenard = new Image();
const imgGrenouille = new Image();
imgRenard.src = 'https://png.pngtree.com/png-vector/20240814/ourmid/pngtree-realistic-fox-head-illustration-png-image_13481187.png';
imgGrenouille.src = 'https://png.pngtree.com/png-vector/20250109/ourlarge/pngtree-realistic-green-frog-with-smooth-skin-and-lifelike-texture-png-image_15076823.png';

/* =======================
   UTILS
======================= */
function resizeCanvas(){ canvas.width=cols*scale; canvas.height=rows*scale; }
function canMove(x,y){ return labyrinth[y] && labyrinth[y][x]!==undefined && labyrinth[y][x]!==1 && labyrinth[y][x]!==3; }
function updateScore(){ scoreEl.textContent=`Score : ${score} | Vies : ${lives}`; }
function formatTime(s){ return `${Math.floor(s/60).toString().padStart(2,'0')}:${(s%60).toString().padStart(2,'0')}`; }
function clamp(v,a,b){ return Math.max(a,Math.min(b,v)); }

/* =======================
   LABYRINTHE & ENTITÃ‰S
======================= */
function generateLabyrinth(){
  labyrinth = JSON.parse(JSON.stringify(labyrinths[currentLabIndex]));
  labyrinth[1][1]=labyrinth[1][2]=labyrinth[2][1]=labyrinth[2][2]=labyrinth[2][3]=labyrinth[3][1]=0;
  totalFrogs=0;
  for(let r=1;r<rows-1;r++){
    for(let c=1;c<cols-1;c++){
      if(labyrinth[r][c]===0 && Math.random()*100>FROG_SPAWN_RATE){
        labyrinth[r][c]=2; totalFrogs++;
      }
    }
  }
  player.x=1; player.y=1; player.xPos=player.x*scale; player.yPos=player.y*scale; player.dir=null; player.moving=false;
  generateGhosts();
}

function generateGhosts(){
  const wanted = clamp(parseInt(ghostCountSel.value||DEFAULT_NUM_GHOSTS),2,5);
  ghosts=[];
  const palette=['red','black','blue','orange','magenta','purple','yellow'];
  const spawns=[{x:cols-2,y:1},{x:cols-2,y:rows-2},{x:1,y:rows-2},{x:Math.floor(cols/2),y:Math.floor(rows/2)},{x:cols-2,y:Math.floor(rows/2)}];
  for(let i=0;i<wanted;i++){
    let {x,y}=spawns[i%spawns.length]; let tries=0;
    while(!canMove(x,y)&&tries<30){ x=clamp(x+(Math.random()<0.5?-1:1),1,cols-2); y=clamp(y+(Math.random()<0.5?-1:1),1,rows-2); tries++; }
    ghosts.push({x,y,xPos:x*scale,yPos:y*scale,dir:'left',color:palette[i%palette.length],moving:false});
  }
}

/* =======================
   DESSIN
======================= */
function drawLabyrinth() {
  for (let r=0; r<rows; r++){
    for (let c=0; c<cols; c++){
      const t = labyrinth[r][c];
      if(t===1){ ctx.fillStyle='#800000'; ctx.fillRect(c*scale,r*scale,scale,scale); }
      else if(t===3){ ctx.fillStyle='#aa6600'; ctx.fillRect(c*scale,r*scale,scale,scale); }
      else if(t===0 || t===2){
        if(t===0 && imgGrenouille.complete) ctx.drawImage(imgGrenouille,c*scale+scale*0.1,r*scale+scale*0.1,scale*0.8,scale*0.8);
      }
    }
  }
}

function drawPlayer(){ if(imgRenard.complete) ctx.drawImage(imgRenard,player.xPos,player.yPos,scale,scale); }

function drawGhosts(){ ghosts.forEach(g=>{
  const gx=g.xPos+scale/2, gy=g.yPos+scale/2;
  ctx.fillStyle=g.color; ctx.beginPath(); ctx.arc(gx,gy,scale/2-4,0,Math.PI*2); ctx.fill();
  ctx.fillStyle='#fff'; ctx.font=`bold ${Math.floor(scale/2)}px monospace`; ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText('R2',gx,gy);
});}

/* =======================
   LOGIQUE
======================= */
function movePlayer(){
  if(!player.moving) return;
  const tx=player.x*scale, ty=player.y*scale;
  player.xPos = player.xPos<tx?Math.min(player.xPos+PLAYER_SPEED,tx):Math.max(player.xPos-PLAYER_SPEED,tx);
  player.yPos = player.yPos<ty?Math.min(player.yPos+PLAYER_SPEED,ty):Math.max(player.yPos-GHOST_SPEED,ty);

  if(player.xPos===tx && player.yPos===ty){
    player.moving=false;
    if(labyrinth[player.y][player.x]===0){ labyrinth[player.y][player.x]=2; score++; updateScore(); }
    if(checkWin()){ handleWin(); }
  }
}

function moveGhosts(){ ghosts.forEach(g=>{
  if(!g.moving){ const dirs=['up','down','left','right']; g.dir=dirs[Math.floor(Math.random()*dirs.length)]; g.moving=true; }
  switch(g.dir){ case 'up': g.y=Math.max(0,g.y-1); break; case 'down': g.y=Math.min(rows-1,g.y+1); break; case 'left': g.x=Math.max(0,g.x-1); break; case 'right': g.x=Math.min(cols-1,g.x+1); break; }
  g.xPos=g.x*scale; g.yPos=g.y*scale;
  if(g.x===player.x && g.y===player.y && !respawning){ lives--; updateScore(); if(lives<=0){ stopGame(); alert('ðŸ’€ Game Over'); } respawnPlayer(); }
});}

function checkWin(){ return score>=totalFrogs; }

function handleWin(){
  const popup=document.getElementById('popup');
  const msg=document.getElementById('popupMessage');
  if(currentLabIndex<labyrinths.length-1){ msg.textContent=`Bravo ! Labyrinthe ${currentLabIndex+1} terminÃ© !`; popup.style.display='block'; }
  else{ msg.textContent='ðŸŽ‰ FÃ©licitations, tous les labyrinthes terminÃ©s !'; popup.style.display='block'; popup.querySelector('button').style.display='none'; }
}

function nextLevel(){
  const popup=document.getElementById('popup'); popup.style.display='none';
  currentLabIndex++;
  if(currentLabIndex<labyrinths.length){ score=0; timeRemaining=LEVEL_TIME; generateLabyrinth(); updateScore(); resizeCanvas(); }
  else{ stopGame(); }
}

function respawnPlayer(){ respawning=true; player.x=1; player.y=1; player.xPos=player.x*scale; player.yPos=player.y*scale; setTimeout(()=>{ respawning=false; },800); }

function gameLoop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawLabyrinth();
  drawPlayer();
  drawGhosts();
  movePlayer();
  moveGhosts();
}

function startGame(){
  if(gameRunning) return;
  gameRunning=true;
  score=0; lives=3; currentLabIndex=0; timeRemaining=LEVEL_TIME;
  generateLabyrinth(); resizeCanvas(); updateScore();
  gameInterval=setInterval(gameLoop,1000/30);
  timerInterval=setInterval(()=>{
    timeRemaining--; timerEl.textContent='Temps restant : '+formatTime(timeRemaining);
    if(timeRemaining<=0){ lives--; updateScore(); if(lives<=0){ stopGame(); alert('ðŸ’€ Game Over'); } timeRemaining=LEVEL_TIME; }
  },1000);
}

function stopGame(){ gameRunning=false; clearInterval(gameInterval); clearInterval(timerInterval); }

/* =======================
   Ã‰VÃ‰NEMENTS
======================= */
startBtn.addEventListener('click',startGame);
scaleInput.addEventListener('change',()=>{ scale=parseInt(scaleInput.value); resizeCanvas(); });
mobileUp.addEventListener('click',()=>{ if(canMove(player.x,player.y-1)){ player.y--; player.moving=true; player.dir='up'; } });
mobileDown.addEventListener('click',()=>{ if(canMove(player.x,player.y+1)){ player.y++; player.moving=true; player.dir='down'; } });
mobileLeft.addEventListener('click',()=>{ if(canMove(player.x-1,player.y)){ player.x--; player.moving=true; player.dir='left'; } });
mobileRight.addEventListener('click',()=>{ if(canMove(player.x+1,player.y)){ player.x++; player.moving=true; player.dir='right'; } });
</script>

</body>
</html>
